.container#app
  .row
    .col
      h1 #{@snek.name} rules
    .col.text-right
      = link_to 'Back', @snek, class: 'btn btn-outline-secondary'

  .row
    .col-md-8.mb-3
      = render 'tools'
    .col-md-4.mb-3
      = render 'logic'

  .row
    - (0..8).each do |pattern_id|
      .col-md-4
        .r-rules-pattern-container.mb-3
          table.r-pattern-table
            - (0..6).each do |row_id|
              tr
                - (0..6).each do |cell_id|
                  td id="c_#{pattern_id}_#{row_id}_#{cell_id}"  v-bind:class="cellClass(#{pattern_id}, #{row_id}, #{cell_id})" v-on:click="setTool({pattern: #{pattern_id}, row: #{row_id}, cell: #{cell_id}})"

javascript:

  // Init app
  var app = new Vue({
      el: '#app',
      data: {
          currentTool: 'default',
          currentLogic: 'and',
          rules: window.gon.snek_rules
      },
      methods: {
          selectTool: function(event) {
              this.currentTool = event.target.dataset.tool;
          },

          selectLogic: function(event) {
              this.currentLogic = event.target.dataset.logic;
          },

          cellClass: function(x,y,z) {
              return 'r-pattern-cell__' + this.rules[x][y][z][0];
          },

          setTool: function(data) {
              switch(this.currentTool) {
                  case 'my_head':
                      if(this.rules[data.pattern][data.row][data.cell] != this.currentTool) {
                          // Find current my head and replace to default
                          for(var i = 0; i < this.rules[data.pattern].length; i++) {
                              for(var j = 0; j < this.rules[data.pattern][i].length; j++) {
                                  if(this.rules[data.pattern][i][j][0] == 'my_head') {
                                      this.rules[data.pattern][i][j][0] = 'default';
                                      this.rules[data.pattern][i][j][1] = 'and';
                                      $('#c_' + data.pattern + '_' + i + '_' + j).removeClass();
                                      $('#c_' + data.pattern + '_' + i + '_' + j).addClass('r-pattern-cell__default');
                                      break;
                                  }
                              }
                          }
                          // Set my head to new position
                          this.rules[data.pattern][data.row][data.cell][0] = this.currentTool;
                          this.rules[data.pattern][data.row][data.cell][1] = 'and';
                          $('#c_' + data.pattern + '_' + data.row + '_' + data.cell).removeClass();
                          $('#c_' + data.pattern + '_' + data.row + '_' + data.cell).addClass('r-pattern-cell__' + this.currentTool);
                      }
                      break;
                  // case 'not':
                  //     if(this.rules[data.pattern][data.row][data.cell][0] != 'my_head' && this.rules[data.pattern][data.row][data.cell][0] != 'default') {
                  //         this.rules[data.pattern][data.row][data.cell][0]
                  //     }
                  //     break;
                  // case 'or':
                  //     break;
                  default:
                      // Do not change for the same cell or if current cell is my head
                      if (this.rules[data.pattern][data.row][data.cell][0] != 'my_head') {
                          this.rules[data.pattern][data.row][data.cell][0] = this.currentTool;
                          this.rules[data.pattern][data.row][data.cell][1] = this.currentLogic;
                          $('#c_' + data.pattern + '_' + data.row + '_' + data.cell).removeClass();
                          $('#c_' + data.pattern + '_' + data.row + '_' + data.cell).addClass('r-pattern-cell__' + this.currentTool);
                      }

                      break;

              }

          }

      }
  });

  // On window resize
  $(document).ready(resizePatterns);
  $(window).resize(resizePatterns);

  // Resize patterns cells
  function resizePatterns() {
      $('.r-pattern-table').height($('.r-pattern-table').width());
      $('.r-pattern-table td').height($('.r-pattern-table td').width());
  }

